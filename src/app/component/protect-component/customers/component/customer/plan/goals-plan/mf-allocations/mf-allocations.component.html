<div *ngIf="!loaderFn.loading" class="bg-white">
    <div class="row bb-1 popup-header-fix w-70">
        <div class="col-md-10 p-0">
            <h4 class="f-16 mb-0 pb-20 wrapper-20">MF allocation</h4>
        </div>
        <div class="col-md-2">
            <i class="material-icons right pt-16 pb-12 c-p" (click)="close()">
        close
      </i>
        </div>
    </div>

    <div class="row pt-72">
        <div class="col-md-4">
            <p class="roboto mb-0 pt-8">Additional savings required</p>
            <div class="mt-8 additional-saving">
                <table mat-table [dataSource]="dataSource" id="table-low">

                    <!-- Position Column -->
                    <ng-container matColumnDef="position">
                        <th mat-header-cell *matHeaderCellDef> </th>
                        <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                    </ng-container>

                    <!-- Name Column -->
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef> Equity </th>
                        <td mat-cell *matCellDef="let element"><span appFormatNumber [value]="element.equity"></span> </td>
                    </ng-container>

                    <!-- Weight Column -->
                    <ng-container matColumnDef="weight">
                        <th mat-header-cell *matHeaderCellDef> Debt </th>
                        <td mat-cell *matCellDef="let element"><span appFormatNumber [value]="element.debt"></span> </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
            </div>
        </div>
        <div class="col-md-8 bl-grey">
            <div class="row">
                <div class="col-md-10 p-0">
                    <p class="m-0 roboto pt-8">Allocate mutual funds to goals from here</p>
                </div>

                <!-- family filter start -->
                <div class="col-md-1 menuButton">
                    <img src="/assets/images/svg/people.svg" class="c-p" [matMenuTriggerFor]="menu">

                    <mat-menu #menu="matMenu">
                        <mat-button-toggle-group (change)="filterAssets()" vertical [(ngModel)]="selectedFamFilter">
                            <mat-button-toggle class="f-14 " value="'all'">
                                <i class="material-icons " *ngIf="selectedFamFilter == 'all'">done </i> All family
                            </mat-button-toggle>

                            <mat-button-toggle class="f-14" [value]="fam.id" *ngFor="let fam of familyList">
                                <i class="material-icons  " *ngIf="selectedFamFilter == fam.id">done</i> {{fam.displayName}}
                            </mat-button-toggle>
                        </mat-button-toggle-group>
                    </mat-menu>
                </div>
                <!-- family filter end -->

                <!-- asset filter -->
                <div class="col-md-1" id="filters">
                    <img src="/assets/images/svg/lines-3.svg" class="c-p" [matMenuTriggerFor]="menu1">
                    <mat-menu #menu1="matMenu">
                        <!-- category filter start -->
                        <p class="text-primitive m-0 pl-24 pb-4 pt-8">Categories</p>
                        <mat-button-toggle-group (change)="filterAssets()" vertical [(ngModel)]="assetFilterValue">
                            <mat-button-toggle [value]="'all'" class="p-0">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="assetFilterValue == 'all'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        All
                                    </div>
                                </div>
                            </mat-button-toggle>
                            <mat-button-toggle [value]="'equity'">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="assetFilterValue == 'equity'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        Equity
                                    </div>
                                </div>
                            </mat-button-toggle>
                            <mat-button-toggle [value]="'debt'">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="assetFilterValue == 'debt'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        Debt
                                    </div>
                                </div>
                            </mat-button-toggle>
                        </mat-button-toggle-group>
                        <!-- category filter end -->

                        <!-- folio filter start -->
                        <p class="text-primitive m-0 pl-24 pb-4 pt-8">Folios</p>
                        <mat-button-toggle-group (change)="filterAssets()" vertical [(ngModel)]="folioFilterValue">
                            <mat-button-toggle [value]="'all'">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="folioFilterValue == 'all'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        All
                                    </div>
                                </div>
                            </mat-button-toggle>
                            <mat-button-toggle [value]="'zero'">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="folioFilterValue == 'zero'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        Zero folios
                                    </div>
                                </div>
                            </mat-button-toggle>
                            <mat-button-toggle [value]="'non-zero'">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="folioFilterValue == 'non-zero'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        Non zero folios
                                    </div>
                                </div>
                            </mat-button-toggle>
                        </mat-button-toggle-group>
                        <!-- folio filter end -->

                        <!-- scheme filter start -->
                        <p class="text-primitive m-0 pl-24 pb-4 pt-8">Schemes</p>
                        <mat-button-toggle-group (change)="filterAssets()" vertical [(ngModel)]="schemeFilterValue">
                            <mat-button-toggle [value]="'all'">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="schemeFilterValue == 'all'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        All schemes
                                    </div>
                                </div>
                            </mat-button-toggle>
                            <mat-button-toggle [value]="'unallocated'">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="schemeFilterValue == 'unallocated'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        Unallocated schemes
                                    </div>
                                </div>
                            </mat-button-toggle>
                            <mat-button-toggle [value]="'allocated'">
                                <div class="row">
                                    <div class="col-md-3">
                                        <i class="material-icons pt-12" *ngIf="schemeFilterValue == 'allocated'">
                      done
                    </i>
                                    </div>
                                    <div class="col-md-9 p-0 f-13">
                                        Allocated schemes
                                    </div>
                                </div>
                            </mat-button-toggle>
                        </mat-button-toggle-group>
                    </mat-menu>
                </div>
            </div>
            <div class="mt-8">
                <table mat-table [dataSource]="dataSource1" id="table-low">

                    <!-- Position Column -->
                    <ng-container matColumnDef="scheme">
                        <th class="w-40" mat-header-cell *matHeaderCellDef> Scheme </th>
                        <td class="w-40" mat-cell *matCellDef="let element">
                            {{element.schemeName}}<span class="text-success pl-8">[SIP]</span>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="family">
                        <td mat-cell *matCellDef="let element" colspan="5" class="text-center text-primary">
                            {{element.displayName}}
                        </td>
                    </ng-container>
                    <!-- Name Column -->
                    <ng-container matColumnDef="value">
                        <th class="w-17" mat-header-cell *matHeaderCellDef> Value | Units</th>
                        <td *matCellDef="let element" class="text-right w-17" mat-cell>
                            <span [value]="element.currentValue" appFormatNumber></span>
                            <span class="text-primitive f-12" appFormatNumber [value]="element.balanceUnit"></span></td>
                    </ng-container>

                    <!-- Weight Column -->
                    <ng-container matColumnDef="goal">
                        <th mat-header-cell *matHeaderCellDef> Goal </th>
                        <td *matCellDef="let element" mat-cell>
                            <div *ngFor="let allocatedGoal of element.goalAssetMapping">
                                <div>{{allocatedGoal.goalName}}</div>
                            </div>

                            <div *ngIf="element.absAllocation < 100">
                                <div>-</div>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="icons">
                        <th mat-header-cell *matHeaderCellDef class="t-10 br">Allocations</th>
                        <td mat-cell *matCellDef="let element" class="t-10 br">

                            <div class="d-flex" *ngFor="let allocatedGoal of element.goalAssetMapping">
                                <div><span appFormatNumber [value]="allocatedGoal.percentAllocated ? allocatedGoal.percentAllocated : 100"></span></div>

                                <button class="unallcoateBtn text-danger" (click)="removeAllocation(element, allocatedGoal)">Unallocate</button>
                                <i class="material-icons c-p text-black" [matMenuTriggerFor]="menu4">
                  more_vert
                </i>

                            </div>
                            <div class="d-flex" *ngIf="element.absAllocation < 100">
                                <button class="allcoateBtn text-primary" (click)="allocateAssetToGoal(element)">Allocate</button>
                                <i class="material-icons c-p text-black" [matMenuTriggerFor]="menu4">
                  more_vert
                </i>

                            </div>
                            <mat-menu #menu4="matMenu">
                                <button mat-menu-item (click)="reallocateAsset(element)">Change allocation percentage</button>
                                <!-- <button mat-menu-item>Detailed view</button>
                                <button mat-menu-item>Activity</button>
                                <button mat-menu-item>Delete</button> -->
                            </mat-menu>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns1; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns1; when: !isFamilyObj"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['family']; when: isFamilyObj"></tr>
                </table>
                <div *ngIf="dataSource1.data.length == 1" class="row pt-70">
                    <div class="d-flex align-items-center col-md-12 flex-column justify-content-center">
                        <img src="assets/images/svg/documents-empty-states.svg">
                        <h4 class="text-center mt-12 mb-20">No schmes Found</h4>
                    </div>
            
                </div>
            </div>
        </div>
    </div>
</div>

<div *ngIf="loaderFn.loading" class="bg-white p-20">Loading data</div>

<div class="bottom-fixed w-100 wrapper-16">
    <div class="row">
        <div class="col-md-12 pl-8">
            <h5 class="mb-0 pt-4 text-white c-p" (click)="close()">Cancel</h5>
        </div>
    </div>
</div>