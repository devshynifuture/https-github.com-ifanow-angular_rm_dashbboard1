<div class="popup-header-fix-50">
    <div class="row bb-1 pt-18 pb-16">
        <div class="col-md-10 d-flex align-items-center f-18">
            <span *ngIf="data !== null">
                <span class="b-primitive p-5 f-14 pr-12 pl-12 d-flex align-items-center br-4 c-p"
                    *ngIf="tabState === 1 && data.status !== 1" (click)="markTaskOrSubTaskDone('task', null, true)">
                    <i class="material-icons mr-4"> done</i> Mark complete
                </span>
                <span class="btn-primary p-5 f-14 pr-12 pl-12 d-flex align-items-center br-4"
                    *ngIf="tabState === 1 && data.status === 1">
                    Completed
                </span>
                <span class="b-primitive p-5 f-14 d-flex align-items-center br-4 c-p"
                    *ngIf="tabState === 2 && (selectedSubTask.status !== 1) "
                    (click)="markTaskOrSubTaskDone('subTask', selectedSubTask, true)">
                    <i class="material-icons mr-4"> done</i> Mark complete
                </span>
                <span class="btn-primary p-5 f-14 pr-12 pl-12 d-flex align-items-center br-4"
                    *ngIf="tabState === 2 && (selectedSubTask.status === 1) "
                    (click)="markTaskOrSubTaskDone('subTask', selectedSubTask, true)">
                    Completed
                </span>
            </span>
            <span *ngIf="data===null">
                Add Task
            </span>
        </div>
        <div class="col-md-2 full-center pr-0">

            <i class="material-icons c-p" (click)="close()"> clear</i>

        </div>
    </div>
</div>


<div [ngClass]="isMainLoading ? 'd-none': ''">
    <div class="mt-80 pb-160" [formGroup]="addTaskForm" *ngIf="tabState == 1">
        <div class="row">
            <div class="col-md-8">
                <h4 class="f-500 roboto" *ngIf="data !== null">
                    {{ data.des }}
                </h4>
            </div>
            <div class="col-md-4 text-right pr-24">
                <img src="assets/images/svg/attchment-icon.svg" *ngIf="data!==null" class="c-p ml-12"
                    (click)="taskFileInput.click()">
                <input type="file" #taskFileInput class="d-none" (change)="taskUpperFile($event.target.files)">

                <!-- <img src="assets/images/svg/sub-task-icon.svg" class="c-p ml-12"> -->
                <img src="assets/images/svg/delect-icon.svg" *ngIf="data!==null" (click)="deleteTask(null)"
                    class="c-p ml-12">
                <!-- <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                    <button mat-menu-item>
                        View linked item
                    </button>
                    <button mat-menu-item disabled>
                        View linked action plan
                    </button>
                    <button mat-menu-item>
                        View activity log
                    </button>
                </mat-menu> -->
            </div>
        </div>

        <div class="row pt-16">
            <div class="w-18 pl-16">
                <h5 class="m-0 pt-12 ws-nowrap text-left">Task description</h5>
            </div>
            <div class="w-82 pl-15 pr-24 arn-ria align-items-center" *ngIf="!isManual">
                <mat-form-field floatLabel="never" appearance="standard" class="form-group mb-0">
                    <mat-select formControlName="searchTemplateList" class="form-control"
                        (selectionChange)="routeToTemplateAddition($event)">
                        <mat-option value='' disabled>Select task template</mat-option>
                        <mat-option [value]="item.id" *ngFor="let item of taskTemplateList"
                            (click)="prefillValues(item)">
                            {{ item.taskDescription }}
                        </mat-option>
                        <mat-option value="-1" class="d-flex align-items-center">
                            <span class="d-flex align-items-center">
                                <i class="material-icons pr-8">add</i>
                                Add task template
                            </span>
                        </mat-option>
                    </mat-select>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
            <div class="w-82 pl-15 pr-24 arn-ria" *ngIf="isManual">
                <mat-form-field floatLabel="never" appearance="standard" class="form-group m-0">
                    <input type="text" matInput formControlName="taskDescription" class="form-control"
                        placeholder="Add a task">
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
        </div>
        <div class="row pt-5">
            <div class="w-20">
            </div>
            <div class="w-41">
            </div>
            <div class="w-38 f-14 text-primitive roboto f-400 text-right" *ngIf="showManualToggle">
                <mat-checkbox [checked]="isManual" (change)="changeFillFormState()"></mat-checkbox> Add manual task
                <img src="/assets/images/svg/plus.svg" alt="plus icon" class="pr-5">

            </div>


        </div>

        <div class="row pt-24 pb-20" *ngIf="isRecurringTaskForm">
            <div class="w-18 pr-15 pl-16">
                <h5 class="m-0 f-14 pt-12">Recurring</h5>
            </div>

            <div class="w-41 pr-15 pl-15 remove-top">
                <mat-form-field floatLabel="never" appearance="standard">
                    <mat-select class="form-control" formControlName="frequency">
                        <mat-option value="" disabled>
                            Select frequency
                        </mat-option>
                        <mat-option *ngFor="let item of recurringTaskFrequencyList" [value]="item.id">
                            {{ item.name }}
                        </mat-option>
                    </mat-select>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="w-41 pr-24 pl-15 remove-top-flex">
                <mat-form-field float="never" appearance="standard" class="ba-date ">
                    <input class="form-control br-0 b-0" formControlName="continuesTill"
                        (input)="preventDefault($event)" (focus)="picker2.open()" matInput [matDatepicker]="picker2"
                        placeholder="Continuous till">
                    <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                    <mat-datepicker #picker2></mat-datepicker>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
        </div>

        <div class="row pt-16" *ngIf="addTaskForm.get('frequency').value === 1 && isRecurringTaskForm">
            <div class="w-18 pt-10 pl-16">
                <h5 class="m-0 f-14 pt-12">Every</h5>
            </div>
            <div class="w-41 pl-15 pr-15">
                <mat-form-field float="never" appearance="standard" class="form-group">
                    <mat-select formControlName="every" class="form-control">
                        <mat-option value="" disabled>
                            Select day
                        </mat-option>
                        <mat-option *ngFor="let item of dayOfWeek" [value]="item.id">
                            {{ item.name }}
                        </mat-option>
                    </mat-select>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
        </div>

        <div class="row pt-24">
            <div class="w-18 pl-16">
                <h5 class="m-0 pt-12">Client</h5>
            </div>

            <div class="w-41  pl-15 pr-15 form-group pl-0 mb-0 arn-ria">
                <mat-form-field floatLabel="never" appearance="standard">
                    <input class="form-control br-0" formControlName="searchClientList"
                        (input)="searchClientFamilyMember(inputSearch.value)" #inputSearch matInput
                        placeholder="Start typing to see client" aria-label="State" [matAutocomplete]="auto">
                    <mat-autocomplete #auto="matAutocomplete">
                        <mat-option *ngFor="let singleClient of clientList"
                            (onSelectionChange)="selectClient(singleClient)" [value]="singleClient.clientId">
                            {{singleClient.displayName}}
                        </mat-option>
                        <mat-option disabled *ngIf="showDefaultDropDownOnSearch && !isLoading">
                            <p class="t-left m-0"> No Client found</p>
                        </mat-option>

                        <!-- empty state -->
                        <!-- 
                        <mat-option class="ht-100" *ngIf="showDefaultDropDownOnSearch && isLoading">
                            <div class="skeletonAnimation" [appSkeletonLoading]="isLoading" appSkeletonLoading>
                                <div class="bar height24"> </div>
                            </div>
                        </mat-option> -->

                        <mat-option *ngIf="showDefaultDropDownOnSearch && isLoading">
                            <div class="skeletonAnimation" [appSkeletonLoading]="isLoading" appSkeletonLoading>
                                <div class="row height24">
                                    <div class="col-md-12 p-0 relClass">
                                        <div class="bar height24"></div>
                                    </div>
                                </div>
                            </div>
                        </mat-option>

                    </mat-autocomplete>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="w-41 pl-15 pr-24 form-group pl-0 mb-0">
                <mat-form-field>
                    <mat-select class="form-control br-0" formControlName="familyMemberId">
                        <mat-option value='' disabled> Select family member</mat-option>
                        <mat-option [value]="item.familyMemberId" *ngFor="let item of familyMemberList">
                            {{ item.displayName }}
                        </mat-option>
                        <mat-option class="relClass" *ngIf="isLoading">
                            <div [appSkeletonLoading]="isLoading">
                                <div class="bar height24"></div>
                            </div>
                        </mat-option>
                    </mat-select>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
        </div>

        <div class="row pt-40">
            <div class="w-18 pl-16">
                <h5 class="m-0 roboto pt-12 f-400">Assigned to</h5>
            </div>

            <div class="w-41 form-group pl-0 mb-0 pl-15 pr-15">
                <mat-form-field>
                    <mat-select class="form-control br-0" formControlName="assignedTo">
                        <mat-option value='' disabled>Select team member</mat-option>
                        <mat-option [value]="item.userId" *ngFor="let item of teamMemberList"
                            (click)="setTeamMember(item.userId)">
                            {{ item.fullName }}
                        </mat-option>
                    </mat-select>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
        </div>

        <div class="row pt-32" *ngIf="!isRecurringTaskForm">
            <div class="w-18 pl-16">
                <h5 class="m-0 roboto f-400 pt-12">Due date</h5>
            </div>

            <div class="w-25 pl-15 pr-15 form-group pl-0 mb-0 remove-top-flex">
                <mat-form-field class="ba-date " appearance="standard" floatLabel="never">
                    <input class="form-control br-0 b-0" formControlName="taskDueDate" [min]="dueDateMinDate" (input)="preventDefault($event)"
                        (focus)="picker.open()" matInput [matDatepicker]="picker" placeholder="01/01/2020">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>

            </div>
            <div class="w-41 d-flex align-items-center">
                <div class="f-14 text-primitive roboto f-400">
                    <mat-checkbox (click)="makeTaskRecurring()"></mat-checkbox> Make this Recurring
                    <img src="/assets/images/svg/plus.svg" alt="plus icon" class="pr-5">
                </div>
            </div>
        </div>
        <!-- <div class="row pb-24">
            <div class="w-18"></div>
            
        </div> -->

        <div class="row pt-40" *ngIf="isRecurringTaskForm">
            <div class="w-18 pl-15">
                <h5 class="m-0 roboto f-400 pt-12 ws-nowrap">Turnaround time</h5>
            </div>

            <div class="w-41 form-group pl-15 pr-15 mb-0">
                <mat-form-field>
                    <mat-select formControlName="taskTurnAroundTime" class="form-control">
                        <mat-option value="" disabled>Select Turnaround time</mat-option>
                        <mat-option *ngFor="let item of taskNumberArr" [value]="item">
                            {{ 'T + ' + item }}
                        </mat-option>
                    </mat-select>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
        </div>


        <div class="row pt-28" *ngIf="showSubTaskHeading">
            <div class="col-md-12 pl-16">
                <h5 class="f-500 m-0 pb-10"> Sub-tasks </h5>
            </div>
        </div>

        <div class="row c-p" *ngFor="let item of subTaskList; index as i" [ngClass]="{'pt-24': i == 0}">
            <div class="col-md-12 pl-20">
                <div class="row pt-5 pb-5 bt-1" [ngClass]="{'bb': i==(subTaskList.length-1)}">
                    <div class="col-md-1 pl-10">
                        <mat-checkbox [checked]="item.status == 1" #subTaskCompleteCheckbox
                            (change)="toggleCheckSubTask(subTaskCompleteCheckbox.checked, item, i)"></mat-checkbox>
                    </div>
                    <div class="col-md-5 pl-0" [ngClass]="subTaskCompleteCheckbox.checked ? 'line-through': ''">
                        {{ item.description }}
                    </div>
                    <div class="col-md-6 text-right pr-0">
                        <div class="full-end">

                            <span *ngIf="!!item.dueDate" class="pr-10">
                                {{ item.dueDate | date: 'dd MMM' }}
                            </span>
                            <span *ngIf="!!item.profilePicUrl" class="pr-10">
                                <img [src]="item.profilePicUrl" alt="profilepic" class="c-p">
                            </span>

                            <span *ngIf="item.hasOwnProperty('assignedToProfileUrl')" class="pr-10">
                                <img [src]="item.assignedToProfileUrl" class="subTaskProfileAvatar"
                                    alt="subtask profile pic">
                            </span>

                            <span *ngIf="!item.hasOwnProperty('assignedToProfileUrl')" class="pr-10">
                                <img src="/assets/images/svg/men-2.svg" class="c-p">
                            </span>

                            <span *ngIf="!item.hasOwnProperty('dueDate')" class="pr-10">
                                <img src="/assets/images/svg/cal1.svg" class="c-p">
                            </span>

                            <span class="pr-10">
                                <img src="/assets/images/svg/delete.svg" alt="delete sub task"
                                    (click)="removeItemFromSubTask(item, i)">
                            </span>
                            <span class="pr-10" *ngIf="item.commentsCount !== 0">
                                {{ item.commentsCount }}
                            </span>
                            <span class="pr-10">
                                <img src="assets/images/svg/msg-chart.svg" class="c-p">
                            </span>
                            <span class="material-icons c-p" (click)="changeTabState(item, 2)"
                                *ngIf="item.status !== 1">
                                keyboard_arrow_right
                            </span>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="row pt-5 pb-5" *ngIf="showNoSubTaskFoundError">
            <h5 class="text-center col-md-12 b-a p-20">
                No Subtasks found
            </h5>
        </div>

        <div formArrayName="subTask" *ngFor="let item of subTask.controls; index as i">
            <div class="row pb-16 pt-24 align-items-center" [formGroupName]="i">
                <div class="col-md-4 pl-30 remove-top">
                    <mat-form-field appearance="standard" floatLabel="never">
                        <input class="form-control br-0 text-left" matInput type="text" formControlName="description"
                            placeholder="Add a subtask">
                        <mat-error>
                            This field is required
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="col-md-3 pl-0 remove-top">

                    <mat-form-field appearance="standard" class="arrowRemoveBox " floatLabel="never">
                        <mat-select class="form-control" formControlName="turnAroundTime">
                            <mat-option value="" disabled>Select Turnaround time</mat-option>
                            <mat-option *ngFor="let item of taskNumberArr" [value]="item">
                                {{ 'T + ' + item }}
                            </mat-option>
                        </mat-select>
                        <mat-error>
                            This field is required
                        </mat-error>
                    </mat-form-field>

                </div>

                <div class="col-md-3 pl-0 remove-top">

                    <mat-form-field appearance="standard" class="arrowRemoveBox" floatLabel="never">
                        <img class="img-pos-two" src="/assets/images/svg/people.svg">
                        <mat-select class="form-control" formControlName="assignedTo">
                            <mat-option value="" disabled>
                                Select Team member
                            </mat-option>
                            <mat-option *ngFor="let item of teamMemberList" [value]="item.userId">
                                {{ item.fullName }}
                            </mat-option>
                        </mat-select>
                        <mat-error>
                            This field is required
                        </mat-error>
                    </mat-form-field>

                </div>

                <div class="col-md-1 p-0 d-flex justify-content-sm-between">
                    <i class="material-icons c-p mt-4 mr-3" [matMenuTriggerFor]="menu3" *ngIf="i === subTask.length-1">
                        add
                    </i>
                    <i class="material-icons c-p mt-4" (click)="removeSubTask(i)">
                        remove
                    </i>
                </div>
            </div>
        </div>

        <div class="row pt-14">
            <div class="col-md-12 text-primitive f-14 pl-16 c-p" [matMenuTriggerFor]="menu3"
                *ngIf="shouldShowAddSubTaskLabel">
                <img src="assets/images/svg/plus-icon-gray.svg" class="c-p"> Add sub-task
            </div>
            <mat-menu #menu3="matMenu" xPosition="after">
                <button mat-menu-item (click)="getSubTaskFromTemplate()"
                    [disabled]="data===null || isManualOrTaskTemplate == 'manual'">
                    Task Template
                </button>
                <button mat-menu-item (click)="addSubTask(null)">
                    Manual
                </button>
            </mat-menu>
        </div>


        <div class="bg-white pt-20" *ngIf="data !== null" [ngClass]="commentList.length ===0 ? 'pb-60':'pb-20'">
            <div class="row">
                <div class="col-md-12 pl-30">
                    <h5 class="f-500 f-16 roboto">Attachments</h5>
                </div>
            </div>
            <div class="row">
                <div class="col-md-5 pl-30" *ngFor="let item of attachmentList; index as i">
                    <div class="row">
                        <div class="col-md-4 pl-0 c-p" [matMenuTriggerFor]="menu2">
                            <div class="attachment-img">
                                <img *ngIf="taskAttachmentPreviewList.length!==0"
                                    [src]="taskAttachmentPreviewList ? taskAttachmentPreviewList[i].attachmentUrl : ''"
                                    alt="attachment preview" />
                            </div>
                        </div>
                        <mat-menu #menu2="matMenu">
                            <button mat-menu-item (click)="downloadAttachment(item)">
                                <div class="row">
                                    <div class="col-md-4 p-0">
                                        <img src="/assets/images/svg/download-icon.svg" class="h-23"
                                            alt="download attachment image">
                                    </div>
                                    <div class="col-md-8 p-0">
                                        Download
                                    </div>
                                </div>


                            </button>
                            <button mat-menu-item (click)="deleteAttachmentOfTaskSubTask(item.id, i, 'task')">
                                <div class="row">
                                    <div class="col-md-4 p-0">
                                        <img class="pr-20 pb-5" src="/assets/images/svg/delete.svg" alt="trash image">
                                    </div>
                                    <div class="col-md-8 p-0">
                                        Remove
                                    </div>
                                </div>


                            </button>
                        </mat-menu>
                        <div class="col-md-8 p-0">
                            <h6>{{ item.attachmentName}}</h6>
                            <p class=" l-18 m-0 text-primitive f-12">UPLOADED TIME</p>
                            <p class=" m-0 l-18 f-12">{{ item.uploadedTime | date:'dd/LL/yyyy hh:mm aaa' }}</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-2" [ngClass]="attachmentList.length === 0 ? 'pl-30': ''">
                    <div class="uploadImgBox c-p d-flex align-items-center justify-content-center"
                        (click)="uploadFileRef.click()">
                        <img src="assets/images/svg/plus-icon-gray.svg" class="c-p">
                        <input type="file" class="d-none" #uploadFileRef
                            (change)="getFileData($event.target.files, 'task')">
                    </div>
                </div>

            </div>
        </div>


        <div class="bg-grey lter pt-20 mb-24" *ngIf="commentList.length !==0">
            <div class="row">
                <div class="col-md-12 pl-30">
                    <h5 class="f-500 roboto">Comments</h5>
                </div>
            </div>

            <div class="row pb-10" *ngFor="let item of commentList; index as i">
                <div class="col-md-1 text-center p-0 pl-30">
                    <img [src]="item.profilePicUrl" class="c-p imgComment">
                </div>
                <div class="col-md-11 pl-20 pr-20">
                    <div class="row">
                        <div class="col-md-8 p-0">
                            <h5 class="f-500 roboto">
                                {{ item.name }}
                                <span class="text-primitive f-12"> {{ item.commentTime | dateAgo }}</span>
                            </h5>
                        </div>
                        <div class="col-md-4 editDelectText text-right">
                            <a class="f-12 c-p" (click)="replyToComment(item, i)">Reply</a>
                            <a class="f-12 c-p" *ngIf="!item.editMode" (click)="toggleEditMode(item, 'task')">Edit</a>
                            <a class="f-12 pl-5 c-p" *ngIf="item.editMode"
                                (click)="saveEditedComment(item, 'task', i, $event)">Save</a>
                            <a class="f-12 pl-5 c-p" (click)="deleteCommentTaskSubTask(item, 'task',i)">Delete</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 p-0">
                            <p class="f-14 m-0" *ngIf="!item.editMode">
                                {{  item.commentMsg }}
                            </p>
                            <div class="row w-100 pt-12">
                                <div class="col-md-1">
                                    <img class="imgComment"
                                        src="http://res.cloudinary.com/futurewise/image/upload/v1585806986/advisor_profile_logo/gmtvhr0lwbskvlpucyfk.png">
                                </div>
                                <div class="col-md-8">
                                    <h5 class="f-500 roboto">
                                        Rahul Jain
                                        <span class="text-primitive f-12"> 1 hours ago</span>
                                    </h5>
                                    <p class="f-14 m-0">dummy text</p>
                                </div>
                                <div class="col-md-3 d-flex editDelectText">
                                    <a class="f-12 c-p">Edit</a>
                                    <a class="f-12 pl-5 c-p">Save</a>
                                    <a class="f-12 pl-5 c-p">Delete</a>
                                </div>
                            </div>
                            <p class="f-14 form-group" *ngIf="item.editMode">
                                <input type="text" [formControl]="commentTaskFC" class="form-control"
                                    [value]="item.commentMsg">
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-80 pb-160" *ngIf="tabState === 2" [formGroup]="editSubTaskForm">
        <div class="row">
            <div class="col-md-1 pl-30">
                <span class="material-icons f-500 c-p" (click)="changeTabState(null,1)">
                    arrow_back
                </span>
            </div>
            <div class="col-md-7">
            </div>
            <div class="col-md-4 text-right pr-24">
                <img src="assets/images/svg/attchment-icon.svg" *ngIf="data!==null" class="c-p ml-12"
                    (click)="taskFileInput.click()">
                <input type="file" #taskFileInput class="d-none" (change)="taskUpperFile($event.target.files)">
                <!-- <img src="assets/images/svg/sub-task-icon.svg" class="c-p ml-12"> -->
                <img src="assets/images/svg/delect-icon.svg" *ngIf="data!==null" (click)="deleteSubTask()"
                    class="c-p ml-12">
                <!-- <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                    <button mat-menu-item>
                        View linked item
                    </button>
                    <button mat-menu-item disabled>
                        View linked action plan
                    </button>
                    <button mat-menu-item>
                        View activity log
                    </button>
                </mat-menu> -->
            </div>
        </div>

        <!-- next page -->
        <!-- next page -->
        <div class="row pt-16">
            <div class="w-24 pl-15">
                <h5 class="m-0 f-14 pt-12 ws-nowrap">Sub task</h5>
            </div>
            <div class="w-50 arn-ria">
                <mat-form-field floatLabel="never" appearance="standard">
                    <input type="text" matInput formControlName="description" class="form-control"
                        placeholder="Add a subtask">
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
        </div>
        <div class="row pt-40">
            <div class="w-24 pl-16">
                <h5 class="m-0 roboto f-400 pt-12">Assigned to</h5>
            </div>

            <div class="w-41 form-group mb-0 pr-15 pl-0">
                <mat-form-field>
                    <mat-select class="form-control br-0" formControlName="assignedTo">
                        <mat-option value="" disabled>Team Member</mat-option>
                        <mat-option [value]="item.userId" *ngFor="let item of teamMemberList"
                            (click)="setTeamMember(item.userId)">
                            {{ item.fullName }}
                        </mat-option>
                    </mat-select>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
        </div>

        <div class="row pt-32">
            <div class="w-24 pl-16">
                <h5 class="m-0 roboto pt-12 f-400">Due date</h5>
            </div>

            <div class="w-30 pl-0 pr-15 form-group mb-0 remove-top-flex">
                <mat-form-field class="ba-date" appearance="standard" floatLabel="never">
                    <input class="form-control br-0 b-0" formControlName="taskDueDate" [min]="dueDateMinDate" (input)="preventDefault($event)"
                        (focus)="picker3.open()" matInput [matDatepicker]="picker3" placeholder="01/01/2020">
                    <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                    <mat-datepicker #picker3></mat-datepicker>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="w-20">
                <p class="f-12 l-18 text-primitive">Repeats every 6 months <br> on 8th day of the month</p>
            </div>
        </div>


        <div class="bg-white pt-20" *ngIf="data !==null"
            [ngClass]="subTaskAttachmentList.length ===0 ? 'pb-60':'pb-20'">
            <div class="row">
                <div class="col-md-12 pl-30">
                    <h5 class="f-500 f-16 roboto">Attachments</h5>
                </div>
            </div>
            <div class="row">
                <div class="col-md-5 pl-30" *ngFor="let item of subTaskAttachmentList; index as i">
                    <div class="row">
                        <div class="col-md-4 pl-0 c-p" [matMenuTriggerFor]="menu2">
                            <div class="attachment-img">
                                <img *ngIf="subTaskAttachmentPreviewList.length!==0"
                                    [src]="subTaskAttachmentPreviewList[i].attachmentUrl" alt="sub task preview list" />
                            </div>
                        </div>
                        <mat-menu #menu2="matMenu">
                            <button mat-menu-item (click)="downloadAttachment(item)">
                                <img src="/assets/images/svg/download-icon.svg" alt="download attachment image">
                                Download
                            </button>
                            <button mat-menu-item (click)="deleteAttachmentOfTaskSubTask(item.id, i, 'subTask')">
                                <img class="pr-20 pb-5" src="/assets/images/svg/delete.svg" alt="trash image">
                                Remove
                            </button>
                        </mat-menu>
                        <div class="col-md-8 p-0">
                            <h6>{{ item.attachmentName}}</h6>
                            <p class=" l-18 m-0 text-primitive f-12">UPLOADED TIME</p>
                            <p class=" m-0 l-18 f-12">{{ item.uploadedTime | date:'dd/LL/yyyy hh:mm aaa' }}</p>
                        </div>

                    </div>
                </div>

                <div class="col-md-2" [ngClass]="subTaskAttachmentList.length === 0 ? 'pl-30': ''">
                    <div class="uploadImgBox c-p d-flex align-items-center justify-content-center"
                        (click)="uploadFileRef.click()">
                        <img src="assets/images/svg/plus-icon-gray.svg" class="c-p">
                        <input type="file" class="d-none" #uploadFileRef
                            (change)="getFileData($event.target.files, 'subTask')">
                    </div>
                </div>

            </div>
        </div>


        <div class="bg-grey lter pt-20 mb-44" *ngIf="subTaskCommentList.length !==0">
            <div class="row">
                <div class="col-md-12 pl-30">
                    <h5 class="f-500 roboto">Comments</h5>
                </div>
            </div>

            <div class="row pb-10" *ngFor="let item of subTaskCommentList; index as i">
                <div class="col-md-1 text-center p-0 pl-30">
                    <img [src]="item.profilePicUrl" class="c-p imgComment">
                </div>
                <div class="col-md-11 pl-20 pr-20">
                    <div class="row">
                        <div class="col-md-8 p-0">
                            <h5 class="f-500 roboto">
                                {{ item.name }}
                                <span class="text-primitive f-12">
                                    {{item.commentTime | dateAgo }}
                                </span>
                            </h5>
                        </div>
                        <div class="col-md-4 editDelectText text-right">
                            <a class="f-12 c-p" *ngIf="!item.editMode"
                                (click)="toggleEditMode(item, 'subTask')">Edit</a>
                            <a class="f-12 c-p" *ngIf="item.editMode"
                                (click)="saveEditedComment(item, 'subTask',i, $event)">Save</a>
                            <a class="f-12 c-p" (click)="deleteCommentTaskSubTask(item, 'subTask',i)">Delete</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 p-0">
                            <p class="f-14 m-0" *ngIf="!item.editMode"> {{ item.commentMsg }}
                            </p>


                            <p class="f-12 form-group" *ngIf="item.editMode">
                                <input type="text" [formControl]="commentSubTaskFC" class="form-control"
                                    [value]="item.commentMsg">
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-44 bottom-fixed-comments" *ngIf="subTaskCommentList.length===0">
            <h5 class="text-center p-20 m-0">
                No Comments Yet
            </h5>
        </div>
    </div>

    <!-- next page ends -->

    <div class="bottomCommentBox bg-grey lter" *ngIf="data!==null">
        <div class="row pt-16 align-items-center">
            <div class="col-md-1 pl-30">
                <img [src]='userProfilePicUrl' class="c-p avatarImg">
            </div>
            <div class="col-md-9 remove-top pr-0">
                <mat-form-field appearance="standard" floatLabel="never">
                    <span>
                        <input class="form-control bg-white br-0 text-left b-0" matInput [formControl]="taskCommentForm"
                            #commentInput type="text" (keyup.enter)="onCreateCommentTaskSubTask(commentInput.value)"
                            placeholder="Add a comment">
                    </span>
                    <mat-error>
                        This field is required
                    </mat-error>
                </mat-form-field>
            </div>
            <div class="col-md-2">
                <button mat-stroked-button class="btn-primary c-p"
                    (click)="onCreateCommentTaskSubTask(commentInput.value)">add</button>
            </div>
        </div>
        <div class="row pt-10">
            <div class="w-10">
            </div>
            <div class="w-90 f-14 p-0 pb-16">
                Collaborators
                <span *ngFor="let item of collaboratorList">
                    <img [src]="item.profilePicUrl" class="c-p ml-12 avatarImg" [matTooltip]="item.name"
                        [matMenuTriggerFor]="menu1">
                    <mat-menu #menu1="matMenu">
                        <button mat-menu-item (click)="removeCollaboratorFromTask(item.id)" [disabled]="item.default"
                            matTooltip="Can't remove default Collaborator" [matTooltipDisabled]="!item.default">
                            Remove
                        </button>
                    </mat-menu>
                </span>

                <span *ngIf="data">
                    <img src="assets/images/svg/avtar-logo.svg" class="c-p ml-12" [matMenuTriggerFor]="menu2">
                    <!-- (click)="onAddingCollaborator(null)" -->
                    <mat-menu #menu2="matMenu">
                        <button mat-menu-item *ngFor="let item of teamMemberList" (click)="onAddingCollaborator(item)"
                            [disabled]="isCollabotatorPresent(item)">
                            {{ item.fullName }}
                        </button>
                    </mat-menu>
                </span>


            </div>
        </div>

    </div>


    <div class="bottom-fixed-50 wrapper-12 pt-16">
        <div class="row">
            <div class="col-md-4">
                <h5 class="mb-0 pt-8 text-white c-p" (click)="close()">Cancel</h5>
            </div>
            <div class="col-md-4">
            </div>
            <div class="col-md-4 text-right" *ngIf="tabState === 1">
                <button class="btn-primary text-white c-p" (click)="formValidationOfTaskForm()"
                    [ngClass]="isMainLoading ? 'cur-wait': ''" mat-stroked-button>
                    <span *ngIf="data!==null">
                        Save
                    </span>
                    <span *ngIf="data===null">
                        Create
                    </span>
                </button>
            </div>
            <div class="col-md-4 text-right" *ngIf="tabState === 2" matTooltip="You must create Task First"
                [matTooltipDisabled]="data!==null">
                <button mat-stroked-button [disabled]="data===null" class="btn-primary text-white c-p"
                    (click)="editedSubTaskSave()" [ngClass]="isMainLoading ? 'cur-wait': ''">
                    Save
                </button>
            </div>
        </div>
    </div>

</div>

<div class="row" *ngIf="isMainLoading">
    <div class="col-md-12 d-flex justify-content-center align-items-center h-80vh">
        <mat-spinner class="loadermiddle-of-slider" [diameter]="30"></mat-spinner>
    </div>
</div>