<div class="popup-header-fix w-65">
    <div class="row bb-1">
        <div class="col-md-8 p-0">
            <h3 class="mb-0 wrapper-20"><img class="c-p mr-8" (click)="backToTransact()" src="/assets/images/svg/back-arrow.svg"> Purchase transaction</h3>
        </div>
        <div class="col-md-4 text-right">
            <div class="wrapper-12">
                <i (click)="close()" class="material-icons c-p pt-8 v-middle"> clear</i>
            </div>
        </div>
    </div>
</div>
<div [formGroup]="purchaseTransaction" cdkScrollable>

    <div class="pt-90 pr-20 pl-20 pb-44">
        <div class="row">
            <div class="col-md-12 p-0">
                <!-- (click)="backToTransact('back',null)" removed for prod build -->

                <h5 class="m-0 text-black">
                    Investor name: {{selectedFamilyMember}}
                </h5>
            </div>
        </div>
        <div class="col-md-12 pl-0 mt-20 all-transactions" *ngIf="multiTransact == true && childTransactions.length > 0">
            <table #tableEl mat-table [dataSource]="childTransactions" id="tbs" class="skeletonAnimation" appSkeletonLoading>
                <ng-container matColumnDef="no">
                    <th *matHeaderCellDef class="br w-4" mat-header-cell> No</th>
                    <td *matCellDef="let element let i = index;" class="br w-4 " mat-cell>
                        <div class="bar"> {{i + 1}} </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="folio">
                    <th *matHeaderCellDef class="br w-16" mat-header-cell> Folio</th>
                    <td *matCellDef="let element" class="br" mat-cell>
                        <div class="bar"> {{element.folioNo}} </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="ownerName">
                    <th *matHeaderCellDef class="br" mat-header-cell> Scheme name</th>
                    <td *matCellDef="let element" class="br" mat-cell>
                        <div class="bar">
                            {{element.schemeName}}
                        </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="amount">
                    <th *matHeaderCellDef class="br w-11 text-right" mat-header-cell> Amount</th>
                    <td *matCellDef="let element" class="br text-right" mat-cell>
                        <div class="bar"> {{element.orderVal}} </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="icons">
                    <th *matHeaderCellDef class="t-2" mat-header-cell></th>
                    <td *matCellDef="let element" class="t-2 c-p" mat-cell>
                        <img [matMenuTriggerFor]="menubank" class="c-p" src="/assets/images/svg/dot-menu.svg">
                        <mat-menu #menubank="matMenu">
                            <button (click)="getdataForm(element,true)" mat-menu-item>Edit</button>
                            <button mat-menu-item>Delete</button>
                        </mat-menu>

                    </td>
                    <td *matFooterCellDef class="br text-right" mat-footer-cell></td>
                </ng-container>
                <tr *matHeaderRowDef="displayedColumns; sticky: true" mat-header-row></tr>
                <tr *matRowDef="let row; columns: displayedColumns;" mat-row></tr>
            </table>
        </div>


        <div class="row pt-20 pb-44">
            <div class="col-md-8 pl-0 pr-20">
                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="m-0 pb-10 text-black">Select from the following options</h5>
                        <mat-radio-group (ngModelChange)="selectSchemeOption($event)" aria-label="Select an option" class="bigRadio" formControlName="schemeSelection">
                            <mat-radio-button value="1" [ngClass]="{'b-a-custom-outline': purchaseTransaction.get('schemeSelection').value==1,'text-primary':purchaseTransaction.get('schemeSelection').value==1,'radio-border':purchaseTransaction.get('schemeSelection').value==2}" class="b-a-custom-outline radioBtn text-primary custom-radio bor_top_tb_left ">
                                Invest in existing scheme
                            </mat-radio-button>
                            <mat-radio-button value="2" [ngClass]="{'b-a-custom-outline': purchaseTransaction.get('schemeSelection').value==2,'text-primary':purchaseTransaction.get('schemeSelection').value==2,'radio-border':purchaseTransaction.get('schemeSelection').value==1}" class="radio-border radioBtn bor_top_tb_right">
                                Select a new scheme
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                </div>
                <!-- value == 1 -->
                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="m-0 pt-28 text-black ">Select a scheme to invest in</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-11 p-0">
                        <div class="form-group">
                            <mat-form-field appearance="standard" floatLabel="never">
                                <!--                (keyup)="getSchemeList($event.target.value)"-->
                                <input (changedValue)="getSchemeList($event)" [matAutocomplete]="auto" appCustomAutoComplete aria-label="Number" class="form-control" formControlName="schemePurchase" matInput placeholder="Start typing to see scheme names" type="text">
                                <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectedScheme($event.option.value)" [displayWith]="processTransaction.displaySchemeName">
                                    <mat-option *ngFor="let scheme of filterSchemeList | async" [value]="scheme">
                                        {{scheme.schemeName}}
                                    </mat-option>
                                </mat-autocomplete>
                                <mat-error *ngIf="purchaseTransaction.get('schemePurchase').errors?.required" class="f-12">
                                    This field is required
                                </mat-error>
                                <mat-error *ngIf="purchaseTransaction.get('schemePurchase').errors?.setValue" class="f-12">
                                    Selected scheme does not exist
                                </mat-error>
                                <mat-hint *ngIf="scheme" align="start" class="f-12 text-custom">Last closing NAV: {{navOfSelectedScheme}}
                                </mat-hint>
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="showSpinner == true" class="col-md-1">
                        <mat-spinner class="mt-20"></mat-spinner>
                    </div>
                </div>

                <div *ngIf="reInvestmentOpt.length > 1" class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="m-0 pt-28 text-black pb-12">Select re-investment</h5>
                    </div>
                    <div class="col-md-5 p-0">
                        <div class="form-group mb-0">
                            <mat-form-field>
                                <mat-select class="form-control" formControlName="reinvest">
                                    <mat-option value='' disabled>Select re-investment</mat-option>
                                    <mat-option (click)="reinvest(flag)" *ngFor="let flag of reInvestmentOpt" value="option">
                                        {{(flag.dividendReinvestmentFlag == 0) ? 'Dividend payout' : 'Dividend reinvestment'}}
                                    </mat-option>
                                </mat-select>
                                <mat-error class="f-12 pt-4">
                                    This field is required
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
                <div class="row pt-28">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="mb-8 text-black">Select folio </h5>
                    </div>
                    <div>
                        <mat-radio-group (ngModelChange)="selectExistingOrNewFolio($event)" aria-label="Select an option" class="smallRadio" formControlName="folioSelection">
                            <mat-radio-button value="1" [ngClass]="{'b-a-custom-outline': purchaseTransaction.get('folioSelection').value==1,'text-primary':purchaseTransaction.get('folioSelection').value==1,'radio-border':purchaseTransaction.get('folioSelection').value==2}" class="b-a-custom-outline radioBtn text-primary custom-radio bor_top_tb_left ">
                                Existing
                            </mat-radio-button>
                            <mat-radio-button value="2" [ngClass]="{'b-a-custom-outline': purchaseTransaction.get('folioSelection').value==2,'text-primary':purchaseTransaction.get('folioSelection').value==2,'radio-border':purchaseTransaction.get('folioSelection').value==1}" class="radio-border bor_top_tb_right radioBtn ">
                                New
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                </div>

                <div *ngIf="ExistingOrNew == 1" class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="mb-8 pt-28 text-black ">Select scheme folio</h5>
                    </div>
                    <div class="col-md-7 p-0">
                        <div class="form-group">
                            <mat-form-field>
                                <mat-select class="form-control" [(ngModel)]="folioNumberShow" formControlName="investmentAccountSelection">
                                    <mat-option *ngIf="folioList.length > 1" value='' disabled>Select scheme folio
                                    </mat-option>
                                    <mat-option (click)="selectedFolio(folio)" *ngFor="let folio of folioList" [value]="folio.folioNumber">{{folio.folioNumber}}</mat-option>
                                </mat-select>
                                <mat-error class="f-12 pt-4">
                                    This field is required
                                </mat-error>
                                <mat-error *ngIf="folioList == undefined" class="f-12 pt-4">
                                    No existing folios
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>

                    <div *ngIf="showSpinnerFolio == true" class="col-md-1 ">
                        <mat-spinner class="mt-8"></mat-spinner>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="mb-8 pt-20 text-black ">Enter amount</h5>
                    </div>

                    <div class="col-md-5 p-0">
                        <div class="form-group paddTopNone iconRupess mb-0">
                            <mat-form-field floatLabel="never" appearance="standard">
                                <input #employeeContry placeholder="Enter amount" appInputValueValidation [inputValidator]="validatorType.NUMBER_ONLY" (keyup)="enteredAmount($event.target.value)" class="form-control rupess" formControlName="employeeContry" matInput maxlength="10" type="text">
                                <mat-hint align="start" class="f-12 text-custom">
                                    Min amount: ₹{{(schemeDetails == undefined) ? '0' : schemeDetails.minAmount }}
                                </mat-hint>
                                <mat-error *ngIf="(purchaseTransaction.get('employeeContry').errors?.min)" class="f-12">
                                    Should be greater than or equal to {{schemeDetails.minAmount}}
                                </mat-error>

                                <mat-error *ngIf="(purchaseTransaction.get('employeeContry').errors?.required)" class="f-12">
                                    This field is requied
                                </mat-error>
                                <mat-error *ngIf="(purchaseTransaction.get('employeeContry').errors?.max)" class="f-12 pt-4">
                                    Amount cannot be greater than mandate amount.
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
                <div *ngIf="platformType == 1">
                    <div class="row">
                        <div class="col-md-5 p-0 text-left">
                            <h5 class="mb-8 pt-40 text-black  ">Select mode of payment</h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-9 p-0">
                            <mat-radio-group (ngModelChange)="selectPaymentMode($event)" aria-label="Select an option" class="mediumRadio" formControlName="modeOfPaymentSelection">
                                <mat-radio-button checked="true" value="1" [ngClass]="{'b-a-custom-outline': purchaseTransaction.get('modeOfPaymentSelection').value==1,'text-primary':purchaseTransaction.get('modeOfPaymentSelection').value==1,'radio-border':purchaseTransaction.get('modeOfPaymentSelection').value==2}"
                                    [disabled]="isMultiTransact" class="b-a-custom-outline radioBtn text-primary custom-radio bor_top_tb_left">
                                    Net banking
                                </mat-radio-button>
                                <mat-radio-button value="2" [ngClass]="{'b-a-custom-outline': purchaseTransaction.get('modeOfPaymentSelection').value==2,'text-primary':purchaseTransaction.get('modeOfPaymentSelection').value==2,'radio-border':purchaseTransaction.get('modeOfPaymentSelection').value==1}"
                                    [disabled]="isMultiTransact" class="b-a radioBtn bor_top_tb_right">
                                    Debit mandate
                                </mat-radio-button>
                            </mat-radio-group>
                        </div>
                        <div *ngIf="showSpinnerMandate" class="col-md-1">
                            <mat-spinner class="mt-8"></mat-spinner>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 bg-grey lter p-0">
                <app-transaction-summary (bankDetailsSend)='getbankDetails($event)' (defaultDetails)='getDefaultDetails($event)' (folioChange)='onFolioChange($event)' [data]="transactionSummary">
                </app-transaction-summary>
            </div>
        </div>

    </div>
</div>

<div class="bottom-fixed row pl-20 pr-20 w-65 d-flex align-items-center">

    <div class="col-md-4 p-0 d-flex align-item-center justifly-content-start">
        <h5 (click)="close()" class="mb-0  text-white c-p">Cancel</h5>
    </div>

    <div class="col-md-8 p-0 d-flex align-item-center justify-content-end">
        <!-- commented for prod build -->


        <button (click)="AddMultiTransaction()" *ngIf="platformType && platformType == 1" class="br-0 text-primary f-14" mat-button mat-raised-button>
            SAVE & ADD ANOTHER
        </button>

        <!-- <button mat-button class="btn-green text-white ml-12" (click)="purchase()">
    SAVE & PROCEED
</button> -->
        <app-progress-button (click)="purchase()" [options]="barButtonOptions" class="btn-green text-white ml-12">
        </app-progress-button>
    </div>

</div>