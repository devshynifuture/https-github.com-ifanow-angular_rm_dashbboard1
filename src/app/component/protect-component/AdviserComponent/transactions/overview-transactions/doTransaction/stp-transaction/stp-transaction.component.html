<div class="popup-header-fix w-65">
    <div class="row bb-1">
        <div class="col-md-8 p-0">
            <h3 class="mb-0 wrapper-20"><img (click)="backToTransact()" class="c-p mr-8"
                    src="/assets/images/svg/back-arrow.svg"> STP transaction</h3>
        </div>
        <div class="col-md-4 text-right">
            <div class="wrapper-12">
                <i (click)="close()" class="material-icons c-p pt-8 v-middle"> clear</i>
            </div>
        </div>
    </div>
</div>
<div [formGroup]="stpTransaction">

    <div class="pt-90 pr-20 pl-20 pb-44">
        <div class="row">
            <div class="col-md-12 p-0">
                <h5 class="m-0 text-black">
                    Investor name: {{selectedFamilyMember}}
                </h5>
            </div>
        </div>
        <div *ngIf="multiTransact == true && childTransactions.length>0" class="col-md-12 mt-20 all-transactions">
            <table [dataSource]="childTransactions" id="table-low" mat-table>
                <ng-container matColumnDef="no">
                    <th *matHeaderCellDef class="br" mat-header-cell> No</th>
                    <td *matCellDef="let element let i = index;" class="br w-15 " mat-cell>
                        <div class="bar"> {{i + 1 }} </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="folio">
                    <th *matHeaderCellDef class="br w-20" mat-header-cell> Folio</th>
                    <td *matCellDef="let element" class="br" mat-cell>
                        <div class="bar"> {{element.folioNo}} </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="ownerName">
                    <th *matHeaderCellDef class="br w-25" mat-header-cell> Scheme name</th>
                    <td *matCellDef="let element" class="br" mat-cell>
                        <div class="bar">
                            {{element.schemeName}}
                        </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="amount">
                    <th *matHeaderCellDef class="br w-20" mat-header-cell> Amount</th>
                    <td *matCellDef="let element" class="br" mat-cell>
                        <div class="bar"> {{element.orderVal}} </div>
                    </td>
                </ng-container>
                <tr *matHeaderRowDef="displayedColumns; sticky: true" mat-header-row></tr>
                <tr *matRowDef="let row; columns: displayedColumns;" mat-row></tr>
            </table>
        </div>
        <div class="row pt-20 pb-44">
            <div class="col-md-8 pl-0 pr-20">
                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="m-0 text-black">Select scheme to transfer out of</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-11 p-0">
                        <div class="form-group">
                            <mat-form-field appearance="standard" floatLabel="never">
                                <input [matAutocomplete]="auto" aria-label="Number" class="form-control"
                                    formControlName="schemeStp" matInput placeholder="Start typing to see scheme names"
                                    type="text">
                                <mat-autocomplete #auto="matAutocomplete"
                                    (optionSelected)="selectedScheme($event.option.value)"
                                    [displayWith]="processTransaction.displaySchemeName">
                                    <mat-option *ngFor="let scheme of filterSchemeList | async" [value]="scheme">
                                        {{scheme.schemeName}}
                                    </mat-option>
                                </mat-autocomplete>
                                <mat-error *ngIf="stpTransaction.get('schemeStp').errors?.required" class="f-12">
                                    This field is required
                                </mat-error>
                                <mat-error *ngIf="stpTransaction.get('schemeStp').errors?.setValue" class="f-12">
                                    No schemes Found </mat-error>
                                <mat-hint *ngIf="scheme" align="start" class="f-12 text-custom">Last closing NAV:
                                    {{navOfSelectedScheme}}
                                </mat-hint>
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="showSpinner == true" class="col-md-1">
                        <mat-spinner class="mt-8"></mat-spinner>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 p-0 text-left">
                        <h5 class="mb-8 pt-28 text-black">Select scheme folio</h5>
                    </div>
                    <div class="col-md-7 p-0">
                        <div class="form-group ">
                            <mat-form-field>
                                <mat-select class="form-control" [(ngModel)]="folioNumberShow"
                                    formControlName="investmentAccountSelection">
                                    <mat-option value='' disabled>Select scheme folio
                                    </mat-option>
                                    <mat-option (click)="selectedFolio(folio)" *ngFor="let folio of folioList"
                                        value="option">
                                        {{folio.folioNumber}}</mat-option>
                                </mat-select>
                                <mat-error class="f-12 pt-4">
                                    This field is required
                                </mat-error>
                                <mat-error *ngIf="folioList == undefined" class="f-12 pt-4">
                                    No existing folios
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="showSpinnerFolio == true" class="col-md-1 ">
                        <mat-spinner class="mt-8"></mat-spinner>
                    </div>
                </div>
                <div *ngIf="showUnits ==true" class="row">
                    <div class="col-md-12 mt-20 pl-0">
                        <div *ngIf="folioDetails" class="bg-grey lter">
                            <div class="row">
                                <div class="col-md-6 p-20 text-left">
                                    <p class="f-14 m-0">Current value</p>
                                    <mat-form-field appearance="standard" floatLabel="never">
                                        <input #currentValue appInputValueValidation
                                            [inputValidator]="validatorType.NUMBER_ONLY" formControlName="currentValue"
                                            matInput type="text">
                                    </mat-form-field>
                                </div>
                                <div class="col-md-6 p-20 text-left">
                                    <p class="f-14 m-0">Balance unit</p>
                                    <mat-form-field appearance="standard" floatLabel="never">
                                        <input #balanceUnit appInputValueValidation
                                            [inputValidator]="validatorType.NUMBER_ONLY" formControlName="balanceUnit"
                                            matInput type="text">
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 pb-12">
                                    <p class="f-12 m-0">Note: Note: Units data provided here is as per data uploaded in
                                        the system. This data may not be updated in NSE NMF. As a result, some
                                        transactions may not go through.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="m-0 pt-28 text-black">Select a scheme to transfer in</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-11 p-0">
                        <div class="form-group">
                            <mat-form-field appearance="standard" floatLabel="never">
                                <input (changedValue)="getSchemeListTranfer($event)" appCustomAutoComplete
                                    [matAutocomplete]="auto1" aria-label="Number" class="form-control"
                                    formControlName="transferIn" matInput
                                    placeholder="Start typing to see transferIn names" type="text">
                                <mat-autocomplete #auto1="matAutocomplete"
                                    (optionSelected)="selectedSchemeTransfer($event.option.value)"
                                    [displayWith]="processTransaction.displaySchemeName">
                                    <mat-option *ngFor="let scheme of filterNewSchemeList  | async" [value]="scheme">
                                        {{scheme.schemeName}}
                                    </mat-option>
                                </mat-autocomplete>
                                <mat-error *ngIf="stpTransaction.get('transferIn').errors?.required" class="f-12">
                                    This field is required
                                </mat-error>
                                <mat-error *ngIf="stpTransaction.get('transferIn').errors?.setValue" class="f-12">
                                    No schemes Found
                                </mat-error>
                                <mat-hint *ngIf="schemeTransfer" align="start" class="f-12 text-custom">Last closing
                                    NAV: {{navOfSelectedScheme}}
                                </mat-hint>
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="showSpinnerTrans == true" class="col-md-1">
                        <mat-spinner class="mt-8"></mat-spinner>
                    </div>
                </div>
                <div *ngIf="reInvestmentOpt.length > 1" class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="m-0 pt-28 text-black pb-12">Select re-investment</h5>
                    </div>
                    <div class="col-md-5 p-0">
                        <div class="form-group mb-0">
                            <mat-form-field>
                                <mat-select class="form-control" formControlName="reinvest">
                                    <mat-option value='' disabled>Select re-investment</mat-option>
                                    <mat-option (click)="reinvest(flag)" *ngFor="let flag of reInvestmentOpt"
                                        value="option">
                                        {{(flag.dividendReinvestmentFlag == 0) ? 'Dividend payout' : 'Dividend reinvestment'}}
                                    </mat-option>
                                </mat-select>
                                <mat-error class="f-12 pt-4">
                                    This field is required
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="mb-8 pt-28 text-black">Select STP frequency</h5>
                    </div>
                    <div class="col-md-5 p-0">
                        <div class="form-group ">
                            <mat-form-field>
                                <mat-select class="form-control" formControlName="frequency">
                                    <mat-option value='' disabled>Select STP frequency</mat-option>
                                    <mat-option (click)="selectedFrequency(frequency)"
                                        *ngFor="let frequency of switchFrequency" [value]="frequency.frequency">
                                        {{frequency.frequencyName}}
                                    </mat-option>
                                </mat-select>
                                <mat-error class="f-12 pt-4">
                                    This field is required
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="mb-8 pt-28 text-black">Enter amount</h5>
                    </div>

                    <div class="col-md-5 p-0">
                        <div class="form-group inputPaddNone">
                            <mat-form-field *ngIf="selectScheme == 2" floatLabel="never" appearance="standard">
                                <input #employeeContry placeholder="Enter amount" appInputValueValidation
                                    [inputValidator]="validatorType.NUMBER_ONLY"
                                    (change)="enteredAmount($event.target.value)" class="form-control br-0 rupess"
                                    formControlName="employeeContry" matInput maxlength="10" type="text">
                                <mat-hint align="start" class="f-12 text-custom">
                                    Min amount:
                                    â‚¹{{(schemeDetailsTransfer == undefined) ? '0' : schemeDetailsTransfer.minimumPurchaseAmount }}
                                </mat-hint>
                                <mat-error *ngIf="(stpTransaction.get('employeeContry').errors?.min)" class="f-12">
                                    Should be greater than or equal to {{schemeDetailsTransfer.minimumPurchaseAmount}}
                                </mat-error>
                                <mat-error *ngIf="(stpTransaction.get('employeeContry').errors?.required)" class="f-12">
                                    This field is requied
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="mb-8 pt-28 text-black ">Select 1st Date STP</h5>
                    </div>

                    <div class="col-md-5 form-group p-0">
                        <mat-form-field>
                            <mat-select class="form-control" formControlName="date">
                                <mat-option value='' disabled>Select 1st Date STP</mat-option>
                                <mat-option *ngFor="let date of dateDisplay" value="{{date.dateToDisplay}}">
                                    {{date.dateToDisplay}}</mat-option>
                            </mat-select>
                            <mat-error class="f-12 pt-4">
                                This field is required
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="mb-8 pt-28  text-black">Select tenure</h5>
                    </div>

                    <div class="col-md-5 form-group p-0">
                        <mat-form-field>
                            <mat-select class="form-control" formControlName="tenure">
                                <mat-option value='' disabled>Select tenure</mat-option>
                                <mat-option value="1">No. of installments</mat-option>
                                <mat-option value="2">No. of years</mat-option>
                                <mat-option *ngIf="getDataSummary && getDataSummary.defaultClient.aggregatorType == 1"
                                    value="3">
                                    Continue until cancelled
                                </mat-option>
                            </mat-select>
                            <mat-error class="f-12 pt-4">
                                This field is required
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div *ngIf="(stpTransaction.get('tenure').value) != 3" class="row">
                    <div class="col-md-12 p-0 text-left">
                        <h5 class="mb-8 pt-28  text-black">Enter
                            {{(stpTransaction.get('tenure').value =='2')?'No. of years':'No. of installments'}}</h5>
                    </div>

                    <div class="col-md-5 form-group inputPaddNone p-0">
                        <mat-form-field floatLabel="never" appearance="standard">
                            <input #employeeContry [inputValidator]="validatorType.NUMBER_ONLY" [maxLength]="4"
                                appInputValueValidation class="form-control br-0 rupess" formControlName="installment"
                                matInput maxlength="4" placeholder="Enter installment" type="number">
                            <mat-error class="f-12 pt-4">
                                This field is required
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
            </div>
            <div class="col-md-4 bg-grey lter p-0">
                <!-- (achmandateDetails)='getAchmandateDetails($event)' for prod build -->
                <app-transaction-summary (bankDetailsSend)='getbankDetails($event)'
                    (defaultDetails)='getDefaultDetails($event)' (folioChange)='onFolioChange($event)'
                    [data]="transactionSummary">
                </app-transaction-summary>
            </div>
        </div>
    </div>
</div>
<div class="bottom-fixed wrapper-12 pt-16 w-65">
    <div class="row">
        <div class="col-md-4 pt-8">
            <h5 (click)="close()" class="mb-0  text-white c-p">Cancel</h5>
        </div>
        <div class="col-md-8 text-right">
            <!-- commented for prod build -->
            <!-- <button mat-raised-button class="br-0 text-success f-14"  (click)="AddMultiTransaction()">
    SAVE & ADD ANOTHER
</button> -->
            <!-- <button mat-button class="btn-green text-white ml-12" (click)="stp()">
    SAVE & PROCEED
</button> -->
            <app-progress-button (click)="stp()" [options]="barButtonOptions" class="btn-green text-white">
            </app-progress-button>
        </div>
    </div>
</div>